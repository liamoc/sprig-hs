<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Graphics/UI/SDL/Sprig/Transform.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-- | A collection of functions for transforming SDL surfaces (rotation, scaling).</span>
<a name="line-2"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Sprig</span><span class='hs-varop'>.</span><span class='hs-conid'>Transform</span> 
<a name="line-3"></a>   <span class='hs-layout'>(</span><span class='hs-varid'>transform</span><span class='hs-layout'>,</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Sprig</span><span class='hs-varop'>.</span><span class='hs-conid'>Transform</span><span class='hs-varop'>.</span><span class='hs-varid'>rotate</span><span class='hs-layout'>,</span> <span class='hs-varid'>rotateAA</span><span class='hs-layout'>,</span> <span class='hs-conid'>Flag</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-4"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span>
<a name="line-5"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span>
<a name="line-6"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>B</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>rotate</span><span class='hs-layout'>)</span>
<a name="line-7"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Rect</span>
<a name="line-8"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Video</span>
<a name="line-9"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-10"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Utilities</span>
<a name="line-11"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Graphics</span><span class='hs-varop'>.</span><span class='hs-conid'>UI</span><span class='hs-varop'>.</span><span class='hs-conid'>SDL</span><span class='hs-varop'>.</span><span class='hs-conid'>Color</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"SPG_Transform"</span>  <span class='hs-varid'>spgTransform</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>SurfaceStruct</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word32</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>SurfaceStruct</span><span class='hs-layout'>)</span>
<a name="line-14"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"SPG_Rotate"</span>     <span class='hs-varid'>spgRotate</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>SurfaceStruct</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word32</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>SurfaceStruct</span><span class='hs-layout'>)</span>
<a name="line-15"></a><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"SPG_RotateAA"</span>   <span class='hs-varid'>spgRotateAA</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>SurfaceStruct</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word32</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>SurfaceStruct</span><span class='hs-layout'>)</span>
<a name="line-16"></a>
<a name="line-17"></a><a name="Flag"></a><span class='hs-comment'>-- | Flags used for transform calls</span>
<a name="line-18"></a><a name="Flag"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Flag</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AntiAlias</span> <span class='hs-comment'>-- ^ Antialiasing is applied to smooth the result of transformation</span>
<a name="line-19"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SafeBitDepths</span> <span class='hs-comment'>-- ^ Take care with unusual bit depths</span>
<a name="line-20"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ColorKeyTransparency</span> <span class='hs-comment'>-- ^ enable colorkey accuracy</span>
<a name="line-21"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FastTextureMap</span> <span class='hs-comment'>-- ^ Faster but uglier texture map renderer</span>
<a name="line-22"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SlowButAccurate</span> <span class='hs-comment'>-- ^ Slower but accurate transform</span>
<a name="line-23"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AlphaBlending</span> <span class='hs-comment'>-- ^ Enable alpha blending</span>
<a name="line-24"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SurfaceAlpha</span>  
<a name="line-25"></a>          <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-26"></a>
<a name="line-27"></a><a name="flagsToWord8"></a><span class='hs-definition'>flagsToWord8</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<a name="line-28"></a><span class='hs-definition'>flagsToWord8</span> <span class='hs-varid'>flags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldl</span> <span class='hs-layout'>(</span><span class='hs-conid'>B</span><span class='hs-varop'>..|.</span><span class='hs-layout'>)</span> <span class='hs-num'>0</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>flagToWord8</span> <span class='hs-varid'>flags</span>
<a name="line-29"></a>   <span class='hs-keyword'>where</span> <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>AntiAlias</span>            <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x01</span>
<a name="line-30"></a>         <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>SafeBitDepths</span>        <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x02</span>
<a name="line-31"></a>         <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>FastTextureMap</span>       <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x04</span>
<a name="line-32"></a>         <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>SlowButAccurate</span>      <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x08</span>
<a name="line-33"></a>         <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>ColorKeyTransparency</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x10</span>
<a name="line-34"></a>         <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>AlphaBlending</span>        <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x20</span>
<a name="line-35"></a>         <span class='hs-varid'>flagToWord8</span> <span class='hs-conid'>SurfaceAlpha</span>         <span class='hs-keyglyph'>=</span> <span class='hs-num'>0x40</span>
<a name="line-36"></a>
<a name="line-37"></a><a name="transform"></a><span class='hs-comment'>-- |Simple transformation of an SDL surface, creating a new surface</span>
<a name="line-38"></a><span class='hs-definition'>transform</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span>  <span class='hs-comment'>-- ^ Surface to transform</span>
<a name="line-39"></a>        <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>Pixel</span>  <span class='hs-comment'>-- ^ Background color for exposed regions (for rotation)</span>
<a name="line-40"></a>        <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>Float</span>  <span class='hs-comment'>-- ^ Rotation angle (degrees/radians specified by control state)</span>
<a name="line-41"></a>        <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>Float</span>  <span class='hs-comment'>-- ^ X scale factor</span>
<a name="line-42"></a>        <span class='hs-keyglyph'>-&gt;</span>  <span class='hs-conid'>Float</span>  <span class='hs-comment'>-- ^ Y scale factor</span>
<a name="line-43"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Flag</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ Transformation flags</span>
<a name="line-44"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Surface</span>
<a name="line-45"></a><span class='hs-definition'>transform</span> <span class='hs-varid'>surf</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pixel</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span> <span class='hs-varid'>f1</span> <span class='hs-varid'>f2</span> <span class='hs-varid'>f3</span> <span class='hs-varid'>flgs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>spgTransform</span> <span class='hs-varid'>s</span> <span class='hs-varid'>w</span> <span class='hs-varid'>f1</span> <span class='hs-varid'>f2</span> <span class='hs-varid'>f3</span> <span class='hs-layout'>(</span><span class='hs-varid'>flagsToWord8</span> <span class='hs-varid'>flgs</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>mkFinalizedSurface</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="rotate"></a><span class='hs-comment'>-- | Rotation convenience function</span>
<a name="line-48"></a><span class='hs-definition'>rotate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pixel</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Surface</span>
<a name="line-49"></a><span class='hs-definition'>rotate</span> <span class='hs-varid'>surf</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pixel</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>spgRotate</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span> <span class='hs-varid'>w</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>mkFinalizedSurface</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="rotateAA"></a><span class='hs-comment'>-- | Rotation convenience function (antialiasing on)</span>
<a name="line-52"></a><span class='hs-definition'>rotateAA</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Float</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pixel</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>Surface</span>
<a name="line-53"></a><span class='hs-definition'>rotateAA</span> <span class='hs-varid'>surf</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pixel</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withForeignPtr</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>spgRotateAA</span> <span class='hs-varid'>s</span> <span class='hs-varid'>f</span> <span class='hs-varid'>w</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>mkFinalizedSurface</span>
</pre></body>
</html>
